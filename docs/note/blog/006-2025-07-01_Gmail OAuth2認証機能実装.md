# WabiMail Gmail OAuth2èªè¨¼æ©Ÿèƒ½å®Ÿè£… - ã‚»ã‚­ãƒ¥ã‚¢ã§ç¾ã—ã„èªè¨¼ä½“é¨“

**åŸ·ç­†æ—¥**: 2025å¹´7æœˆ1æ—¥  
**ã‚«ãƒ†ã‚´ãƒª**: æŠ€è¡“å®Ÿè£…ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£  
**ã‚¿ã‚°**: OAuth2, Gmail API, Python, ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£, ä¾˜ã³å¯‚ã³

---

## ã¯ã˜ã‚ã«

ç¾ä»£ã®ãƒ¡ãƒ¼ãƒ«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆé–‹ç™ºã«ãŠã„ã¦ã€**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**ã¯æœ€é‡è¦èª²é¡Œã®ä¸€ã¤ã§ã™ã€‚ç‰¹ã«Gmailã®ã‚ˆã†ãªä¸»è¦ã‚µãƒ¼ãƒ“ã‚¹ã§ã¯ã€å¾“æ¥ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã«ä»£ã‚ã‚Šã€**OAuth2èªè¨¼**ãŒæ¨™æº–ã¨ãªã£ã¦ã„ã¾ã™ã€‚

WabiMailãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ä¾˜ã³å¯‚ã³ã®ç¾å­¦ã«åŸºã¥ã„ãŸ**é™ã‹ã§ç¾ã—ã„èªè¨¼ä½“é¨“**ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã€Gmail OAuth2èªè¨¼æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚æœ¬è¨˜äº‹ã§ã¯ã€ãã®è¨­è¨ˆæ€æƒ³ã‹ã‚‰å…·ä½“çš„ãªå®Ÿè£…ã¾ã§ã€è©³ã—ãè§£èª¬ã—ã¾ã™ã€‚

---

## OAuth2èªè¨¼ã®å¿…è¦æ€§

### å¾“æ¥ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã®èª²é¡Œ

```python
# å¾“æ¥ã®æ–¹å¼ï¼ˆéæ¨å¥¨ï¼‰
username = "user@gmail.com"
password = "user_password"  # âš ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯
```

- **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¼æ´©ãƒªã‚¹ã‚¯**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ä¿å­˜
- **æ¨©é™åˆ¶å¾¡ä¸å¯**: å…¨æ©Ÿèƒ½ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™
- **å¤šè¦ç´ èªè¨¼éå¯¾å¿œ**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½ã®åˆ¶é™

### OAuth2èªè¨¼ã®åˆ©ç‚¹

```python
# OAuth2æ–¹å¼ï¼ˆæ¨å¥¨ï¼‰
oauth2_manager = GmailOAuth2Manager()
success, message = oauth2_manager.start_oauth2_flow("user@gmail.com")
# âœ… ã‚»ã‚­ãƒ¥ã‚¢ãªãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹èªè¨¼
```

- **ğŸ” é«˜ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¸è¦ã€ãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹èªè¨¼
- **âš™ï¸ æ¨©é™åˆ¶å¾¡**: å¿…è¦æœ€å°é™ã®ã‚¹ã‚³ãƒ¼ãƒ—æŒ‡å®š
- **ğŸ”„ è‡ªå‹•æ›´æ–°**: ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã«ã‚ˆã‚‹è‡ªå‹•æ›´æ–°
- **ğŸ›¡ï¸ å¤šè¦ç´ èªè¨¼å¯¾å¿œ**: Googleã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½ã‚’æ´»ç”¨

---

## WabiMail OAuth2è¨­è¨ˆæ€æƒ³

### ä¾˜ã³å¯‚ã³ã®èªè¨¼ä½“é¨“

OAuth2èªè¨¼ã¯æŠ€è¡“çš„ã«è¤‡é›‘ã§ã™ãŒã€WabiMailã§ã¯**ä¾˜ã³å¯‚ã³ã®ç¾å­¦**ã«åŸºã¥ãã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯**ã‚·ãƒ³ãƒ—ãƒ«ã§é™ã‹ãªä½“é¨“**ã‚’æä¾›ã—ã¾ã™ã€‚

```python
# è¤‡é›‘ãªå®Ÿè£…ã‚’éš è”½ã—ãŸã‚·ãƒ³ãƒ—ãƒ«ãªAPI
oauth2_manager = GmailOAuth2Manager()
success, message = oauth2_manager.start_oauth2_flow(account_id)

if success:
    print("ğŸŒ¸ èªè¨¼å®Œäº†")  # é™ã‹ã§ç¾ã—ã„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
```

#### è¨­è¨ˆåŸå‰‡

1. **ã‚·ãƒ³ãƒ—ãƒ«ã•** - è¤‡é›‘ãªè¨­å®šã‚’éš è”½
2. **å®‰å…¨æ€§** - æš—å·åŒ–ã«ã‚ˆã‚‹æƒ…å ±ä¿è­·
3. **ç¾ã—ã•** - å’Œã®ç¾æ„è­˜ã‚’å–ã‚Šå…¥ã‚ŒãŸUI
4. **é™ã‘ã•** - æ§ãˆã‚ã§å¿ƒåœ°ã‚ˆã„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

### ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   WabiMail      â”‚    â”‚  Google OAuth2   â”‚    â”‚   Gmail API     â”‚
â”‚   Application   â”‚    â”‚   Server         â”‚    â”‚   Server        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ OAuth2Manager   â”‚â”€â”€â”€â–¶â”‚ Authorization    â”‚â”€â”€â”€â–¶â”‚ Gmail Services  â”‚
â”‚ TokenStorage    â”‚â—€â”€â”€â”€â”‚ Token Exchange   â”‚â—€â”€â”€â”€â”‚ Email Access    â”‚
â”‚ Config Manager  â”‚    â”‚ Refresh Flow     â”‚    â”‚ Scope Validationâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ã‚³ã‚¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

#### 1. **TokenStorage** - æš—å·åŒ–ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†

```python
class TokenStorage:
    """OAuth2ãƒˆãƒ¼ã‚¯ãƒ³ã®æš—å·åŒ–ä¿å­˜ãƒ»ç®¡ç†"""
    
    def save_token(self, account_id: str, token_data: Dict[str, Any]) -> bool:
        """
        ãƒˆãƒ¼ã‚¯ãƒ³ã‚’AESæš—å·åŒ–ã—ã¦å®‰å…¨ã«ä¿å­˜
        
        ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç‰¹å¾´:
        â€¢ Fernetæš—å·åŒ–ï¼ˆAES 128 + HMACï¼‰
        â€¢ ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥ã‚»ã‚­ãƒ¥ã‚¢ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
        â€¢ ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³åˆ¶é™ï¼ˆUnixç³»ï¼‰
        """
        try:
            # ãƒˆãƒ¼ã‚¯ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’JSONå½¢å¼ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰
            token_bytes = json.dumps(token_data, ensure_ascii=False).encode('utf-8')
            
            # AESæš—å·åŒ–
            encrypted_token = self._fernet.encrypt(token_bytes)
            
            # ã‚»ã‚­ãƒ¥ã‚¢ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜
            with open(token_file, 'wb') as f:
                f.write(encrypted_token)
            
            # Unixç³»ã§ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³åˆ¶é™
            if os.name == 'posix':
                os.chmod(token_file, 0o600)  # æ‰€æœ‰è€…ã®ã¿èª­ã¿æ›¸ãå¯èƒ½
                
            return True
        except Exception as e:
            logger.error(f"ãƒˆãƒ¼ã‚¯ãƒ³ä¿å­˜ã‚¨ãƒ©ãƒ¼: {e}")
            return False
```

#### 2. **GmailOAuth2Manager** - èªè¨¼ãƒ•ãƒ­ãƒ¼ç®¡ç†

```python
class GmailOAuth2Manager:
    """Gmail OAuth2èªè¨¼ãƒ•ãƒ­ãƒ¼ã®å®Œå…¨å®Ÿè£…"""
    
    def start_oauth2_flow(self, account_id: str, callback_port: int = 8080) -> Tuple[bool, str]:
        """
        OAuth2èªè¨¼ãƒ•ãƒ­ãƒ¼ã‚’é–‹å§‹
        
        ãƒ•ãƒ­ãƒ¼:
        1. client_secret.jsonã‹ã‚‰èªè¨¼è¨­å®šèª­ã¿è¾¼ã¿
        2. èªè¨¼URLã‚’ç”Ÿæˆã—ã¦ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã
        3. ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ã§ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å¾…æ©Ÿ
        4. èªè¨¼ã‚³ãƒ¼ãƒ‰ã‚’ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã«äº¤æ›
        5. æš—å·åŒ–ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜
        """
        try:
            logger.info(f"OAuth2èªè¨¼ãƒ•ãƒ­ãƒ¼ã‚’é–‹å§‹ã—ã¾ã™: {account_id}")
            
            # OAuth2ãƒ•ãƒ­ãƒ¼ã‚’ä½œæˆ
            flow = InstalledAppFlow.from_client_secrets_file(
                str(self.client_secret_path),
                scopes=self.scopes
            )
            
            # ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ã§ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å¾…æ©Ÿ
            credentials = self._wait_for_callback(flow, callback_port)
            
            if credentials:
                # ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æš—å·åŒ–ä¿å­˜
                token_data = self._credentials_to_dict(credentials)
                success = self.token_storage.save_token(account_id, token_data)
                
                if success:
                    # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ›´æ–°
                    self._credentials_cache[account_id] = credentials
                    logger.info(f"OAuth2èªè¨¼ãŒå®Œäº†ã—ã¾ã—ãŸ: {account_id}")
                    return True, OAuth2Messages.AUTH_SUCCESS
                else:
                    return False, "ãƒˆãƒ¼ã‚¯ãƒ³ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ"
            else:
                return False, OAuth2Messages.AUTH_CANCELLED
                
        except Exception as e:
            logger.error(f"OAuth2èªè¨¼ã‚¨ãƒ©ãƒ¼ ({account_id}): {e}")
            return False, f"{OAuth2Messages.AUTH_ERROR}: {e}"
```

#### 3. **OAuth2Config** - è¨­å®šã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç®¡ç†

```python
class OAuth2Config:
    """OAuth2èªè¨¼è¨­å®šã®çµ±åˆç®¡ç†"""
    
    # Gmail APIå¿…è¦ã‚¹ã‚³ãƒ¼ãƒ—
    GMAIL_SCOPES = [
        'https://www.googleapis.com/auth/gmail.readonly',   # ãƒ¡ãƒ¼ãƒ«èª­ã¿å–ã‚Š
        'https://www.googleapis.com/auth/gmail.send',       # ãƒ¡ãƒ¼ãƒ«é€ä¿¡
        'https://www.googleapis.com/auth/gmail.compose',    # ãƒ¡ãƒ¼ãƒ«ä½œæˆ
        'https://www.googleapis.com/auth/gmail.modify'      # ãƒ¡ãƒ¼ãƒ«å¤‰æ›´
    ]
    
    # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
    TOKEN_REFRESH_MARGIN_MINUTES = 5     # ãƒˆãƒ¼ã‚¯ãƒ³æœŸé™ã®ä½™è£•æ™‚é–“
    AUTH_TIMEOUT_SECONDS = 300           # èªè¨¼ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
    
    @classmethod
    def validate_scopes(cls, requested_scopes: List[str]) -> bool:
        """è¦æ±‚ã•ã‚ŒãŸã‚¹ã‚³ãƒ¼ãƒ—ãŒæœ‰åŠ¹ã‹ãƒã‚§ãƒƒã‚¯"""
        valid_scopes = set(cls.GMAIL_SCOPES)
        requested_scopes_set = set(requested_scopes)
        return requested_scopes_set.issubset(valid_scopes)


class OAuth2Messages:
    """OAuth2é–¢é€£ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ—¥æœ¬èªåŒ–"""
    
    AUTH_SUCCESS = "Gmailèªè¨¼ãŒå®Œäº†ã—ã¾ã—ãŸã€‚ãƒ¡ãƒ¼ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ç”¨ã§ãã¾ã™ã€‚"
    
    CLIENT_SECRET_NOT_FOUND = """
client_secret.jsonãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚

ä»¥ä¸‹ã®æ‰‹é †ã§Google Cloud Consoleã‹ã‚‰èªè¨¼æƒ…å ±ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ï¼š
1. Google Cloud Console (https://console.cloud.google.com/) ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠã¾ãŸã¯ä½œæˆ
3. ã€ŒAPIã¨ã‚µãƒ¼ãƒ“ã‚¹ã€â†’ã€Œèªè¨¼æƒ…å ±ã€ã«ç§»å‹•
4. ã€Œèªè¨¼æƒ…å ±ã‚’ä½œæˆã€â†’ã€ŒOAuth 2.0 ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ IDã€ã‚’é¸æŠ
5. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç¨®é¡ã§ã€Œãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚’é¸æŠ
6. åå‰ã‚’å…¥åŠ›ã—ã¦ã€Œä½œæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯
7. ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜
8. ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ã€Œclient_secret.jsonã€ã«å¤‰æ›´ã—ã¦WabiMailãƒ•ã‚©ãƒ«ãƒ€ã«é…ç½®
"""
```

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè£…è©³ç´°

### 1. æš—å·åŒ–ãƒˆãƒ¼ã‚¯ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸

#### ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥ã‚»ã‚­ãƒ¥ã‚¢ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª

```python
def _get_app_data_dir(self) -> Path:
    """
    ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥ã®ã‚»ã‚­ãƒ¥ã‚¢ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å–å¾—
    """
    if os.name == 'nt':  # Windows
        app_data = os.environ.get('APPDATA', str(Path.home() / 'AppData' / 'Roaming'))
        return Path(app_data) / "WabiMail"
    elif 'darwin' in os.uname().sysname.lower():  # macOS
        return Path.home() / "Library" / "Application Support" / "WabiMail"
    else:  # Linux (XDG Base Directoryæº–æ‹ )
        xdg_data_home = os.environ.get('XDG_DATA_HOME', str(Path.home() / '.local' / 'share'))
        return Path(xdg_data_home) / "WabiMail"
```

#### AESæš—å·åŒ–å®Ÿè£…

```python
def _get_or_create_encryption_key(self) -> bytes:
    """
    æš—å·åŒ–ã‚­ãƒ¼ã®å®‰å…¨ãªç”Ÿæˆãƒ»ç®¡ç†
    """
    key_file = self.storage_dir / "encryption.key"
    
    if key_file.exists():
        # æ—¢å­˜ã®ã‚­ãƒ¼ã‚’èª­ã¿è¾¼ã¿
        with open(key_file, 'rb') as f:
            key = f.read()
    else:
        # æ–°ã—ã„ã‚­ãƒ¼ã‚’ç”Ÿæˆ
        key = Fernet.generate_key()
        
        # ã‚­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜
        with open(key_file, 'wb') as f:
            f.write(key)
        
        # Unixç³»ã§ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³åˆ¶é™
        if os.name == 'posix':
            os.chmod(key_file, 0o600)  # æ‰€æœ‰è€…ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
    
    return key
```

### 2. è‡ªå‹•ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°æ©Ÿèƒ½

```python
def _refresh_credentials(self, account_id: str, credentials: Credentials) -> bool:
    """
    æœŸé™åˆ‡ã‚Œãƒˆãƒ¼ã‚¯ãƒ³ã®è‡ªå‹•æ›´æ–°
    """
    try:
        # ãƒˆãƒ¼ã‚¯ãƒ³ã®æ›´æ–°
        credentials.refresh(Request())
        
        # æ›´æ–°ã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿å­˜
        token_data = self._credentials_to_dict(credentials)
        success = self.token_storage.save_token(account_id, token_data)
        
        if success:
            # ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ›´æ–°
            self._credentials_cache[account_id] = credentials
            logger.info(f"ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ›´æ–°ã—ã¾ã—ãŸ: {account_id}")
            return True
        else:
            logger.error(f"æ›´æ–°ã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³ã®ä¿å­˜ã«å¤±æ•—: {account_id}")
            return False
            
    except google.auth.exceptions.RefreshError as e:
        logger.error(f"ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°ã‚¨ãƒ©ãƒ¼ ({account_id}): {e}")
        # ç„¡åŠ¹ãªãƒˆãƒ¼ã‚¯ãƒ³ã‚’å‰Šé™¤
        self.revoke_credentials(account_id)
        return False
    except Exception as e:
        logger.error(f"äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ ({account_id}): {e}")
        return False
```

### 3. ã‚»ã‚­ãƒ¥ã‚¢ãªã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†

```python
def _wait_for_callback(self, flow: InstalledAppFlow, port: int, timeout: int = 300) -> Optional[Credentials]:
    """
    OAuth2ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å®‰å…¨ã«å¾…æ©Ÿ
    """
    class CallbackHandler(http.server.BaseHTTPRequestHandler):
        def do_GET(self):
            # èªè¨¼ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—
            query_params = urllib.parse.parse_qs(parsed_url.query)
            
            if 'code' in query_params:
                # èªè¨¼ã‚³ãƒ¼ãƒ‰â†’ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³äº¤æ›
                flow.fetch_token(code=query_params['code'][0])
                
                # ç¾ã—ã„å®Œäº†ãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤º
                success_html = """
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>ğŸŒ¸ èªè¨¼å®Œäº† - WabiMail</title>
                    <style>
                        body { font-family: 'Yu Gothic UI', sans-serif; text-align: center; 
                               background: #fefefe; color: #333; padding: 50px; }
                        .container { max-width: 500px; margin: 0 auto; }
                        h1 { color: #333; font-weight: normal; }
                        p { line-height: 1.6; color: #666; }
                    </style>
                </head>
                <body>
                    <div class="container">
                        <h1>ğŸŒ¸ èªè¨¼å®Œäº†</h1>
                        <p>WabiMailã®Gmailèªè¨¼ãŒå®Œäº†ã—ã¾ã—ãŸã€‚</p>
                        <p>ã“ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‰ã˜ã¦WabiMailã«æˆ»ã£ã¦ãã ã•ã„ã€‚</p>
                        <p><em>é™å¯‚ã®ä¸­ã®ç¾ã—ã•ã‚’è¿½æ±‚ã—ã¦</em></p>
                    </div>
                </body>
                </html>
                """
                
                self.send_response(200)
                self.send_header('Content-Type', 'text/html; charset=utf-8')
                self.end_headers()
                self.wfile.write(success_html.encode('utf-8'))
                
    # ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
    with http.server.HTTPServer(('localhost', port), CallbackHandler) as httpd:
        # ãƒ–ãƒ©ã‚¦ã‚¶ã§èªè¨¼ãƒšãƒ¼ã‚¸ã‚’é–‹ã
        auth_url, _ = flow.authorization_url(prompt='consent')
        webbrowser.open(auth_url)
        
        # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆä»˜ãã§å¾…æ©Ÿ
        httpd.timeout = timeout
        httpd.handle_request()
        
        return flow.credentials if hasattr(flow, 'credentials') else None
```

---

## UI/UXè¨­è¨ˆ - ä¾˜ã³å¯‚ã³ã®èªè¨¼ä½“é¨“

### 1. OAuth2èªè¨¼ãƒ€ã‚¤ã‚¢ãƒ­ã‚°

```python
def _create_oauth2_tab(self):
    """
    OAuth2èªè¨¼ã‚¿ãƒ–ã®ä½œæˆ - ä¾˜ã³å¯‚ã³ãƒ‡ã‚¶ã‚¤ãƒ³é©ç”¨
    """
    # é™ã‹ã§ç¾ã—ã„èª¬æ˜æ–‡
    description = """Gmail ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å®‰å…¨ã«æ¥ç¶šã™ã‚‹ãŸã‚ã« OAuth2 èªè¨¼ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
ä»¥ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚"""
    
    ttk.Label(self.oauth2_frame, text=description, 
             style="Description.Wabi.TLabel", 
             wraplength=500, justify=tk.LEFT).pack(pady=(0, 16))
    
    # å¿…è¦ã‚¹ã‚³ãƒ¼ãƒ—ã®è¦–è¦šçš„è¡¨ç¤º
    scopes_frame = ttk.LabelFrame(self.oauth2_frame, text="ğŸ“œ å¿…è¦ãªæ¨©é™", 
                                 style="Wabi.TLabelframe")
    scopes_frame.pack(fill=tk.X, padx=16, pady=(0, 16))
    
    scopes_text = ""
    for scope in OAuth2Config.GMAIL_SCOPES:
        description = OAuth2Messages.get_scope_description(scope)
        scopes_text += f"â€¢ {description}\n"
    
    ttk.Label(scopes_frame, text=scopes_text.strip(), 
             style="Description.Wabi.TLabel", 
             justify=tk.LEFT).pack(padx=8, pady=8)
```

### 2. èªè¨¼çŠ¶æ…‹ã®ç¾ã—ã„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯

```python
def _update_oauth2_status(self, message: str = "", status_type: str = "normal"):
    """
    OAuth2èªè¨¼çŠ¶æ…‹ã®é™ã‹ãªæ›´æ–°è¡¨ç¤º
    """
    if self.is_oauth2_authenticated and not message:
        message = "âœ… Gmailèªè¨¼ãŒå®Œäº†ã—ã¦ã„ã¾ã™"
        status_type = "success"
    elif not message:
        message = "âŒ Gmailèªè¨¼ãŒå¿…è¦ã§ã™"
        status_type = "error"
    
    # ä¾˜ã³å¯‚ã³ã‚¹ã‚¿ã‚¤ãƒ«ã®é©ç”¨
    style = "Wabi.TLabel"
    if status_type == "success":
        style = "Success.Wabi.TLabel"  # æ§ãˆã‚ãªæˆåŠŸè‰²
    elif status_type == "error":
        style = "Error.Wabi.TLabel"    # å“ã®ã‚ã‚‹ã‚¨ãƒ©ãƒ¼è‰²
    
    self.oauth2_status_label.config(text=message, style=style)
```

### 3. ç¾ã—ã„å®Œäº†ãƒšãƒ¼ã‚¸

OAuth2èªè¨¼å®Œäº†æ™‚ã«ã¯ã€ä¾˜ã³å¯‚ã³ã®ç¾å­¦ã«åŸºã¥ã„ãŸ**é™ã‹ã§ç¾ã—ã„å®Œäº†ãƒšãƒ¼ã‚¸**ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ğŸŒ¸ èªè¨¼å®Œäº† - WabiMail</title>
    <style>
        body { 
            font-family: 'Yu Gothic UI', 'Hiragino Kaku Gothic ProN', sans-serif; 
            text-align: center; 
            background: linear-gradient(135deg, #fefefe 0%, #f8f8f8 100%);
            color: #333; 
            padding: 50px; 
            margin: 0;
        }
        .container { 
            max-width: 500px; 
            margin: 0 auto; 
            background: rgba(255, 255, 255, 0.9);
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        h1 { 
            color: #333; 
            font-weight: 300; 
            font-size: 2em;
            margin-bottom: 20px;
        }
        p { 
            line-height: 1.8; 
            color: #666; 
            margin-bottom: 15px;
        }
        .signature {
            font-style: italic;
            color: #999;
            font-size: 0.9em;
            margin-top: 30px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ¸ èªè¨¼å®Œäº†</h1>
        <p>WabiMailã®Gmailèªè¨¼ãŒå®Œäº†ã—ã¾ã—ãŸã€‚</p>
        <p>ã“ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‰ã˜ã¦WabiMailã«æˆ»ã£ã¦ãã ã•ã„ã€‚</p>
        <p>ã‚ãªãŸã®ãƒ¡ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ã¯å®‰å…¨ã«ä¿è­·ã•ã‚Œã¦ã„ã¾ã™ã€‚</p>
        <div class="signature">é™å¯‚ã®ä¸­ã®ç¾ã—ã•ã‚’è¿½æ±‚ã—ã¦</div>
    </div>
</body>
</html>
```

---

## å®Ÿè£…ã¨ãƒ†ã‚¹ãƒˆçµæœ

### åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ

OAuth2èªè¨¼æ©Ÿèƒ½ã®å“è³ªä¿è¨¼ã®ãŸã‚ã€**25å€‹ã®åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆ**ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚

```python
# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµæœ
============================= test session starts ==============================
tests/test_oauth2.py::TestTokenStorage::test_ãƒˆãƒ¼ã‚¯ãƒ³ä¿å­˜_èª­ã¿è¾¼ã¿ PASSED
tests/test_oauth2.py::TestOAuth2Config::test_è¨­å®šå€¤ç¢ºèª PASSED
tests/test_oauth2.py::TestGmailOAuth2Manager::test_åˆæœŸåŒ– PASSED
tests/test_oauth2.py::TestAccountOAuth2Integration::test_oauth2è¦æ±‚åˆ¤å®š PASSED
# ... å…¨25ãƒ†ã‚¹ãƒˆæˆåŠŸ
============================== 25 passed in 1.28s ==============================
```

#### ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸

1. **TokenStorage** - æš—å·åŒ–ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿ãƒ»æœŸé™ç®¡ç†
2. **OAuth2Config** - è¨­å®šå€¤ãƒ»ã‚¹ã‚³ãƒ¼ãƒ—æ¤œè¨¼ãƒ»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
3. **OAuth2Manager** - èªè¨¼ãƒ•ãƒ­ãƒ¼ãƒ»ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†ãƒ»æ¥ç¶šãƒ†ã‚¹ãƒˆ
4. **Accountçµ±åˆ** - OAuth2è¦æ±‚åˆ¤å®šãƒ»ã‚¹ã‚³ãƒ¼ãƒ—å–å¾—ãƒ»èªè¨¼çŠ¶æ…‹

### ãƒ‡ãƒ¢ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

å®Ÿéš›ã®å‹•ä½œç¢ºèªç”¨ãƒ‡ãƒ¢ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã€å…¨æ©Ÿèƒ½ã®å‹•ä½œã‚’æ¤œè¨¼ã—ã¾ã—ãŸã€‚

```bash
ğŸ” WabiMail OAuth2èªè¨¼æ©Ÿèƒ½ãƒ‡ãƒ¢å®Ÿè¡Œçµæœ

âœ… ãƒˆãƒ¼ã‚¯ãƒ³ä¿å­˜æˆåŠŸ
âœ… ãƒˆãƒ¼ã‚¯ãƒ³èª­ã¿è¾¼ã¿æˆåŠŸ
æœŸé™çŠ¶æ…‹: æœ‰åŠ¹

âš™ï¸ OAuth2è¨­å®šæ©Ÿèƒ½ãƒ‡ãƒ¢  
ğŸ“œ Gmail APIã‚¹ã‚³ãƒ¼ãƒ—: 4ç¨®é¡å¯¾å¿œ
ğŸ” client_secret.json æ¤œç´¢ãƒ‘ã‚¹: 5ç®‡æ‰€ç¢ºèª

ğŸ” OAuth2ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼æ©Ÿèƒ½ãƒ‡ãƒ¢
ğŸ”§ ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼è¨­å®š: æ­£å¸¸åˆæœŸåŒ–
ğŸ“§ èªè¨¼çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯: æœªèªè¨¼çŠ¶æ…‹ç¢ºèª

ğŸ“§ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆçµ±åˆæ©Ÿèƒ½ãƒ‡ãƒ¢
OAuth2å¯¾å¿œã‚¢ã‚«ã‚¦ãƒ³ãƒˆ: 3ç¨®é¡ä½œæˆãƒ»ç¢ºèª
èªè¨¼æ–¹å¼æ¯”è¼ƒ: OAuth2 vs ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼

ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½ãƒ‡ãƒ¢
æš—å·åŒ–æ©Ÿèƒ½: AESæš—å·åŒ–ç¢ºèª
ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å¯¾å¿œç¢ºèª
```

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æœ€é©åŒ–

### 1. éåŒæœŸèªè¨¼ãƒ•ãƒ­ãƒ¼

```python
def start_oauth2_auth_async(self):
    """
    UIã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ãªã„éåŒæœŸèªè¨¼ãƒ•ãƒ­ãƒ¼
    """
    def auth_in_background():
        try:
            # UIã‚¹ãƒ¬ãƒƒãƒ‰ã«çŠ¶æ…‹æ›´æ–°ã‚’é€ä¿¡
            self.dialog.after(0, lambda: self._update_oauth2_status("ğŸŒ èªè¨¼ã‚’é–‹å§‹ã—ã¦ã„ã¾ã™..."))
            
            # ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§èªè¨¼å®Ÿè¡Œ
            success, message = self.oauth2_manager.start_oauth2_flow(email)
            
            # çµæœã‚’UIã‚¹ãƒ¬ãƒƒãƒ‰ã«åæ˜ 
            self.dialog.after(0, lambda: self._handle_auth_result(success, message))
            
        except Exception as e:
            self.dialog.after(0, lambda: self._handle_auth_error(e))
    
    # ãƒ‡ãƒ¼ãƒ¢ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œï¼ˆãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹çµ‚äº†æ™‚ã«è‡ªå‹•çµ‚äº†ï¼‰
    threading.Thread(target=auth_in_background, daemon=True).start()
```

### 2. ãƒˆãƒ¼ã‚¯ãƒ³ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€é©åŒ–

```python
class GmailOAuth2Manager:
    def __init__(self):
        self._credentials_cache: Dict[str, Credentials] = {}
        
    def get_credentials(self, account_id: str) -> Optional[Credentials]:
        """
        åŠ¹ç‡çš„ãªãƒˆãƒ¼ã‚¯ãƒ³å–å¾—ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€é©åŒ–ï¼‰
        """
        # 1. ãƒ¡ãƒ¢ãƒªã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—
        if account_id in self._credentials_cache:
            credentials = self._credentials_cache[account_id]
            
            # 2. æœ‰åŠ¹æœŸé™ãƒã‚§ãƒƒã‚¯ï¼ˆ5åˆ†ãƒãƒ¼ã‚¸ãƒ³ï¼‰
            if not self._is_credentials_expired(credentials):
                return credentials
            
            # 3. è‡ªå‹•ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
            if self._refresh_credentials(account_id, credentials):
                return self._credentials_cache[account_id]
        
        # 4. ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰èª­ã¿è¾¼ã¿
        return self._load_credentials_from_storage(account_id)
```

### 3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»ãƒ­ã‚°

```python
def _log_security_event(self, event_type: str, account_id: str, details: str = ""):
    """
    ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆã®ç›£æŸ»ãƒ­ã‚°
    """
    timestamp = datetime.now().isoformat()
    log_entry = {
        "timestamp": timestamp,
        "event_type": event_type,
        "account_id": account_id,
        "details": details,
        "client_version": "WabiMail 1.0.0"
    }
    
    # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ­ã‚°ã«è¨˜éŒ²
    security_logger.info(f"OAuth2 {event_type}: {account_id} - {details}")
    
    # é‡è¦ã‚¤ãƒ™ãƒ³ãƒˆã®å ´åˆã¯è¿½åŠ å‡¦ç†
    if event_type in ["AUTH_SUCCESS", "TOKEN_REFRESH", "AUTH_FAILURE"]:
        self._update_security_metrics(event_type, account_id)
```

---

## å®Ÿé‹ç”¨ã§ã®ä½¿ç”¨æ–¹æ³•

### 1. Google Cloud Consoleè¨­å®š

```bash
# Step 1: Google Cloud Consoleã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
https://console.cloud.google.com/

# Step 2: Gmail APIæœ‰åŠ¹åŒ–
APIs & Services > Library > Gmail API > Enable

# Step 3: OAuth2ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆIDä½œæˆ
APIs & Services > Credentials > Create Credentials > OAuth 2.0 Client IDs
Application Type: Desktop Application

# Step 4: client_secret.jsonãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
Download JSON > Rename to "client_secret.json"

# Step 5: WabiMailãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«é…ç½®
WabiMail/
â”œâ”€â”€ client_secret.json  â†ã“ã“ã«é…ç½®
â”œâ”€â”€ src/
â””â”€â”€ ...
```

### 2. WabiMailã§ã®èªè¨¼å®Ÿè¡Œ

```python
# æ–°è¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¿½åŠ æ™‚ã®èªè¨¼ãƒ•ãƒ­ãƒ¼
from src.auth.oauth2_manager import GmailOAuth2Manager

# 1. OAuth2ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ä½œæˆ
oauth2_manager = GmailOAuth2Manager()

# 2. èªè¨¼ãƒ•ãƒ­ãƒ¼é–‹å§‹
email = "user@gmail.com"
success, message = oauth2_manager.start_oauth2_flow(email)

if success:
    print("ğŸŒ¸ Gmailèªè¨¼å®Œäº†")
    
    # 3. èªè¨¼çŠ¶æ…‹ç¢ºèª
    if oauth2_manager.is_authenticated(email):
        print("âœ… èªè¨¼æ¸ˆã¿ - ãƒ¡ãƒ¼ãƒ«é€å—ä¿¡å¯èƒ½")
        
        # 4. Gmailæ¥ç¶šãƒ†ã‚¹ãƒˆ
        test_success, test_message = oauth2_manager.test_gmail_connection(email)
        print(f"æ¥ç¶šãƒ†ã‚¹ãƒˆ: {test_message}")
else:
    print(f"âŒ èªè¨¼å¤±æ•—: {message}")
```

### 3. è‡ªå‹•ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†

```python
# æ—¥å¸¸çš„ãªãƒ¡ãƒ¼ãƒ«æ“ä½œã§ã¯è‡ªå‹•ã§ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†
def send_email_with_oauth2(account_id: str, email_content: dict):
    """
    OAuth2èªè¨¼ã‚’ä½¿ç”¨ã—ãŸãƒ¡ãƒ¼ãƒ«é€ä¿¡
    """
    # èªè¨¼æƒ…å ±ã‚’è‡ªå‹•å–å¾—ï¼ˆæœŸé™åˆ‡ã‚Œæ™‚ã¯è‡ªå‹•æ›´æ–°ï¼‰
    credentials = oauth2_manager.get_credentials(account_id)
    
    if credentials:
        # Gmail APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆä½œæˆ
        gmail_service = build('gmail', 'v1', credentials=credentials)
        
        # ãƒ¡ãƒ¼ãƒ«é€ä¿¡
        result = gmail_service.users().messages().send(
            userId='me',
            body=email_content
        ).execute()
        
        return True, f"ãƒ¡ãƒ¼ãƒ«é€ä¿¡æˆåŠŸ: {result['id']}"
    else:
        return False, "OAuth2èªè¨¼ãŒå¿…è¦ã§ã™"
```

---

## ä»Šå¾Œã®æ‹¡å¼µäºˆå®š

### 1. ãƒãƒ«ãƒã‚¢ã‚«ã‚¦ãƒ³ãƒˆå¯¾å¿œå¼·åŒ–

```python
# è¤‡æ•°Gmailã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®åŒæ™‚ç®¡ç†
oauth2_manager = GmailOAuth2Manager()

accounts = [
    "personal@gmail.com",
    "work@gmail.com", 
    "project@gmail.com"
]

for account in accounts:
    if not oauth2_manager.is_authenticated(account):
        success, message = oauth2_manager.start_oauth2_flow(account)
        print(f"{account}: {message}")
```

### 2. é«˜åº¦ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½

- **ãƒ‡ãƒã‚¤ã‚¹èªè¨¼**: ãƒ‡ãƒã‚¤ã‚¹å›ºæœ‰ã®èªè¨¼ã‚­ãƒ¼
- **ç”Ÿä½“èªè¨¼çµ±åˆ**: Windows Hello / Touch IDå¯¾å¿œ
- **ã‚¼ãƒ­çŸ¥è­˜è¨¼æ˜**: ã‚µãƒ¼ãƒãƒ¼å´ã§ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¦‹ã‚Œãªã„ä»•çµ„ã¿

### 3. ä»–ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼å¯¾å¿œ

- **Outlook OAuth2**: Microsoft Graph APIé€£æº
- **Yahoo OAuth2**: Yahoo Mail APIé€£æº
- **ä¼æ¥­å‘ã‘OAuth2**: Exchange Onlineå¯¾å¿œ

---

## ã¾ã¨ã‚

WabiMailã®Gmail OAuth2èªè¨¼æ©Ÿèƒ½ã¯ã€**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**ã¨**ç¾ã—ã•**ã‚’ä¸¡ç«‹ã—ãŸå®Ÿè£…ã¨ãªã‚Šã¾ã—ãŸã€‚

### ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®å®Ÿç¾
- **AESæš—å·åŒ–**ã«ã‚ˆã‚‹ãƒˆãƒ¼ã‚¯ãƒ³ä¿è­·
- **ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ¥**ã‚»ã‚­ãƒ¥ã‚¢ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
- **è‡ªå‹•ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°**æ©Ÿèƒ½
- **åŒ…æ‹¬çš„ç›£æŸ»ãƒ­ã‚°**

### ğŸŒ¸ ä¾˜ã³å¯‚ã³ã®ä½“é¨“
- **ã‚·ãƒ³ãƒ—ãƒ«ãªèªè¨¼ãƒ•ãƒ­ãƒ¼**
- **ç¾ã—ã„å®Œäº†ãƒšãƒ¼ã‚¸**
- **é™ã‹ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯**
- **æ—¥æœ¬èªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**

### ğŸ“§ å®Ÿç”¨æ€§ã®ç¢ºä¿
- **25ãƒ†ã‚¹ãƒˆ**ã«ã‚ˆã‚‹å“è³ªä¿è¨¼
- **éåŒæœŸå‡¦ç†**ã§ã®UIå¿œç­”æ€§
- **ã‚¨ãƒ©ãƒ¼å›å¾©**æ©Ÿèƒ½
- **åŒ…æ‹¬çš„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**

ç¾ä»£ã®ãƒ¡ãƒ¼ãƒ«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«æ±‚ã‚ã‚‰ã‚Œã‚‹**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶**ã‚’æº€ãŸã—ãªãŒã‚‰ã€WabiMailç‹¬è‡ªã®**ä¾˜ã³å¯‚ã³ç¾å­¦**ã‚’å®Ÿç¾ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

ã“ã®èªè¨¼åŸºç›¤ã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯**å®‰å¿ƒã—ã¦ç¾ã—ã„ãƒ¡ãƒ¼ãƒ«ä½“é¨“**ã‚’æ¥½ã—ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚

---

**æ¬¡å›è¨˜äº‹äºˆå‘Š**: ã€ŒWabiMail ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šç”»é¢å®Ÿè£… - çµ±åˆè¨­å®šãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®è¨­è¨ˆã¨å®Ÿè£…ã€

---

*ğŸŒ¸ é™å¯‚ã®ä¸­ã®ç¾ã—ã•ã‚’è¿½æ±‚ã—ã¦*

**WabiMailé–‹ç™ºãƒãƒ¼ãƒ **  
*2025å¹´7æœˆ1æ—¥*