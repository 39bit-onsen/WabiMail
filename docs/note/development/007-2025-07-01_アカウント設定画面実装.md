# Task 7: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šç”»é¢å®Ÿè£… - é–‹ç™ºè¨˜éŒ²

**å®Ÿè£…æ—¥**: 2025å¹´7æœˆ1æ—¥  
**ã‚¿ã‚¹ã‚¯**: Task 7: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šç”»é¢ - G005ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šãƒ€ã‚¤ã‚¢ãƒ­ã‚°  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å®Œäº†

---

## ğŸ¯ ã‚¿ã‚¹ã‚¯æ¦‚è¦

WabiMailã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šç”»é¢ï¼ˆG005ï¼‰ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚ä¾˜ã³å¯‚ã³ã®ç¾å­¦ã«åŸºã¥ã„ãŸé™ã‹ã§ç¾ã—ã„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æä¾›ã—ã€Gmail OAuth2èªè¨¼ã¨æ‰‹å‹•è¨­å®šã®ä¸¡æ–¹ã«å¯¾å¿œã—ãŸçµ±åˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿç¾ã—ã¾ã—ãŸã€‚

---

## ğŸ“¦ å®Ÿè£…ã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

### 1. **AccountDialog** - çµ±åˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šãƒ€ã‚¤ã‚¢ãƒ­ã‚°
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `src/ui/account_dialog.py` (800+ lines)
- **æ©Ÿèƒ½**:
  - ä¾˜ã³å¯‚ã³ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šUI
  - OAuth2èªè¨¼ã‚¿ãƒ–ã¨æ‰‹å‹•è¨­å®šã‚¿ãƒ–
  - Gmailè‡ªå‹•è¨­å®šã¨IMAP/SMTP/POPæ‰‹å‹•è¨­å®š
  - æ¥ç¶šãƒ†ã‚¹ãƒˆæ©Ÿèƒ½
  - ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç·¨é›†ãƒ»æ–°è¦ä½œæˆ
  - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œè¨¼ã¨ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯

### 2. **OAuth2çµ±åˆ** - Gmailèªè¨¼ã¨ã®é€£æº
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `src/auth/oauth2_manager.py` (é€£æº)
- **æ”¹å–„ç‚¹**:
  - ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã¨ã®ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹çµ±åˆ
  - èªè¨¼çŠ¶æ…‹ã®è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
  - ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—å¾Œã®è‡ªå‹•è¨­å®š
  - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å¼·åŒ–

### 3. **ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†é€£æº** - AccountManagerã¨ã®çµ±åˆ
- **ãƒ•ã‚¡ã‚¤ãƒ«**: `src/mail/account_manager.py` (é€£æº)
- **é€£æºæ©Ÿèƒ½**:
  - ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä¿å­˜ãƒ»æ›´æ–°
  - é‡è¤‡ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½
  - è¨­å®šæ¤œè¨¼æ©Ÿèƒ½
  - ã‚»ã‚­ãƒ¥ã‚¢ãªèªè¨¼æƒ…å ±ç®¡ç†

---

## ğŸ¨ ä¾˜ã³å¯‚ã³ãƒ‡ã‚¶ã‚¤ãƒ³å®Ÿè£…

### UIç¾å­¦ã®ä½“ç¾
```python
# ä¾˜ã³å¯‚ã³ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ
wabi_colors = {
    "bg": "#fefefe",           # ç´”ç™½ã®èƒŒæ™¯
    "fg": "#333333",           # å¢¨ã®ã‚ˆã†ãªæ–‡å­—è‰²
    "entry_bg": "#fcfcfc",     # å…¥åŠ›æ¬„ã®èƒŒæ™¯
    "border": "#e0e0e0",       # ç¹Šç´°ãªå¢ƒç•Œç·š
    "accent": "#8b7355",       # ä¾˜ã³å¯‚ã³ã‚¢ã‚¯ã‚»ãƒ³ãƒˆè‰²
    "button_bg": "#f8f8f8",    # ãƒœã‚¿ãƒ³èƒŒæ™¯
    "success": "#4a7c59",      # æˆåŠŸè‰²
    "warning": "#b8860b",      # è­¦å‘Šè‰²
    "error": "#cd5c5c"         # ã‚¨ãƒ©ãƒ¼è‰²
}

# å’Œã®ç¾æ„è­˜ã«åŸºã¥ããƒ•ã‚©ãƒ³ãƒˆè¨­å®š
wabi_fonts = {
    "header": ("Yu Gothic UI", 12, "bold"),
    "body": ("Yu Gothic UI", 11, "normal"),
    "small": ("Yu Gothic UI", 9, "normal")
}
```

### é™ã‹ã§é›†ä¸­ã§ãã‚‹ç’°å¢ƒ
- **ã‚¿ãƒ–ãƒ™ãƒ¼ã‚¹ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³**: OAuth2ã¨æ‰‹å‹•è¨­å®šã®æ˜ç¢ºãªåˆ†é›¢
- **æ®µéšçš„ãªå…¥åŠ›ãƒ•ãƒ­ãƒ¼**: å¿…è¦ãªæƒ…å ±ã‚’é †åºç«‹ã¦ã¦å…¥åŠ›
- **é©åˆ‡ãªä½™ç™½**: æƒ…å ±ã®æ•´ç†ã¨è¦–è¦šçš„ãªä¼‘æ¯
- **æ§ãˆã‚ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯**: é‚ªé­”ã«ãªã‚‰ãªã„çŠ¶æ…‹è¡¨ç¤º

---

## ğŸ”§ æŠ€è¡“å®Ÿè£…è©³ç´°

### ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```python
class AccountDialog:
    """ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚¯ãƒ©ã‚¹"""
    
    def __init__(self, parent, account: Optional[Account] = None, 
                 success_callback: Optional[Callable[[Account], None]] = None):
        """
        ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’åˆæœŸåŒ–
        
        Args:
            parent: è¦ªã‚¦ã‚£ãƒ³ãƒ‰ã‚¦
            account: ç·¨é›†å¯¾è±¡ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆNoneã®å ´åˆã¯æ–°è¦ä½œæˆï¼‰
            success_callback: æˆåŠŸæ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°
        """
        self.parent = parent
        self.account = account
        self.account_manager = AccountManager()
        self.oauth2_manager = GmailOAuth2Manager()
        self.result_account: Optional[Account] = None
        self.success_callback = success_callback
        
        # ãƒ•ã‚©ãƒ¼ãƒ å¤‰æ•°ã®åˆæœŸåŒ–
        self._init_form_variables()
        
        # UIæ§‹ç¯‰
        self._create_dialog()
        self._load_account_data()
```

### 2ã¤ã®ã‚¿ãƒ–ã«ã‚ˆã‚‹è¨­å®šæ–¹å¼

#### 1. OAuth2èªè¨¼ã‚¿ãƒ–
```python
def _create_oauth2_tab(self):
    """OAuth2èªè¨¼ã‚¿ãƒ–ã‚’ä½œæˆ"""
    oauth2_frame = ttk.Frame(self.notebook, style="Wabi.TFrame")
    self.notebook.add(oauth2_frame, text="ğŸ” OAuth2èªè¨¼ (æ¨å¥¨)")
    
    # Gmail OAuth2ã®èª¬æ˜
    description_text = """Gmail OAuth2èªè¨¼ã¯æœ€ã‚‚å®‰å…¨ã§æ¨å¥¨ã•ã‚Œã‚‹èªè¨¼æ–¹å¼ã§ã™ã€‚
Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ç›´æ¥ãƒ­ã‚°ã‚¤ãƒ³ã—ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ä¿å­˜ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“ã€‚"""
    
    desc_label = tk.Label(
        oauth2_frame,
        text=description_text,
        font=self.wabi_fonts["body"],
        bg=self.wabi_colors["bg"],
        fg=self.wabi_colors["fg"],
        justify=tk.LEFT,
        wraplength=450
    )
    desc_label.pack(padx=20, pady=10)
    
    # OAuth2èªè¨¼ãƒœã‚¿ãƒ³
    oauth2_button = tk.Button(
        oauth2_frame,
        text="ğŸš€ Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§èªè¨¼",
        font=self.wabi_fonts["header"],
        bg=self.wabi_colors["accent"],
        fg="white",
        relief=tk.FLAT,
        padx=20,
        pady=10,
        command=self._start_oauth2_authentication
    )
    oauth2_button.pack(pady=20)
    
    # èªè¨¼çŠ¶æ…‹è¡¨ç¤º
    self.oauth2_status_label = tk.Label(
        oauth2_frame,
        text="èªè¨¼ã‚’é–‹å§‹ã—ã¦ãã ã•ã„",
        font=self.wabi_fonts["small"],
        bg=self.wabi_colors["bg"],
        fg=self.wabi_colors["fg"]
    )
    self.oauth2_status_label.pack(pady=10)
```

#### 2. æ‰‹å‹•è¨­å®šã‚¿ãƒ–
```python
def _create_manual_tab(self):
    """æ‰‹å‹•è¨­å®šã‚¿ãƒ–ã‚’ä½œæˆ"""
    manual_frame = ttk.Frame(self.notebook, style="Wabi.TFrame")
    self.notebook.add(manual_frame, text="âš™ï¸ æ‰‹å‹•è¨­å®š")
    
    # ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ãƒ•ãƒ¬ãƒ¼ãƒ 
    canvas = tk.Canvas(manual_frame, bg=self.wabi_colors["bg"])
    scrollbar = ttk.Scrollbar(manual_frame, orient="vertical", command=canvas.yview)
    scrollable_frame = ttk.Frame(canvas, style="Wabi.TFrame")
    
    # ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåŸºæœ¬æƒ…å ±
    self._create_basic_info_section(scrollable_frame)
    
    # ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚¿ã‚¤ãƒ—é¸æŠ
    self._create_account_type_section(scrollable_frame)
    
    # å—ä¿¡ã‚µãƒ¼ãƒãƒ¼è¨­å®š
    self._create_incoming_server_section(scrollable_frame)
    
    # é€ä¿¡ã‚µãƒ¼ãƒãƒ¼è¨­å®š
    self._create_outgoing_server_section(scrollable_frame)
    
    # èªè¨¼è¨­å®š
    self._create_auth_section(scrollable_frame)
    
    # æ¥ç¶šãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³
    self._create_connection_test_section(scrollable_frame)
```

### OAuth2èªè¨¼ãƒ•ãƒ­ãƒ¼å®Ÿè£…

```python
def _start_oauth2_authentication(self):
    """OAuth2èªè¨¼ã‚’é–‹å§‹"""
    try:
        self._update_oauth2_status("ğŸ”„ èªè¨¼ã‚’é–‹å§‹ã—ã¦ã„ã¾ã™...", "info")
        
        # ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§èªè¨¼å‡¦ç†
        def authenticate():
            try:
                # OAuth2ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œ
                success, result = self.oauth2_manager.start_oauth2_flow(
                    account_id=f"oauth2_{self.email_var.get() or 'temp'}"
                )
                
                # ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã§çµæœã‚’å‡¦ç†
                self.dialog.after(0, lambda: self._handle_oauth2_result(success, result))
                
            except Exception as e:
                self.dialog.after(0, lambda: self._handle_oauth2_error(str(e)))
        
        # èªè¨¼ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’é–‹å§‹
        auth_thread = threading.Thread(target=authenticate, daemon=True)
        auth_thread.start()
        
    except Exception as e:
        logger.error(f"OAuth2èªè¨¼é–‹å§‹ã‚¨ãƒ©ãƒ¼: {e}")
        self._update_oauth2_status(f"âŒ èªè¨¼é–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸ: {e}", "error")

def _handle_oauth2_result(self, success: bool, result: str):
    """OAuth2èªè¨¼çµæœã‚’å‡¦ç†"""
    if success:
        try:
            # ãƒˆãƒ¼ã‚¯ãƒ³æƒ…å ±ã‹ã‚‰åŸºæœ¬æƒ…å ±ã‚’å–å¾—
            token_info = self.oauth2_manager.get_token_info()
            if token_info and 'email' in token_info:
                self.email_var.set(token_info['email'])
                self.name_var.set(token_info.get('name', token_info['email']))
                self.display_name_var.set(token_info.get('name', ''))
            
            # Gmailè¨­å®šã‚’è‡ªå‹•è¨­å®š
            self.account_type_var.set("GMAIL")
            self.auth_type_var.set("OAUTH2")
            self._set_gmail_server_settings()
            
            self.is_oauth2_authenticated = True
            self._update_oauth2_status("âœ… OAuth2èªè¨¼ãŒå®Œäº†ã—ã¾ã—ãŸ", "success")
            
            # ä¿å­˜ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
            if self.save_button:
                self.save_button.config(state=tk.NORMAL)
                
        except Exception as e:
            logger.error(f"OAuth2çµæœå‡¦ç†ã‚¨ãƒ©ãƒ¼: {e}")
            self._update_oauth2_status(f"âŒ èªè¨¼æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: {e}", "error")
    else:
        self._update_oauth2_status(f"âŒ OAuth2èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ: {result}", "error")
```

### æ¥ç¶šãƒ†ã‚¹ãƒˆæ©Ÿèƒ½

```python
def _test_connection(self):
    """æ¥ç¶šãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ"""
    try:
        # å…¥åŠ›æ¤œè¨¼
        if not self._validate_server_settings():
            return
        
        self._update_connection_status("ğŸ”„ æ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆã—ã¦ã„ã¾ã™...", "info")
        
        def test_connection():
            try:
                # ãƒ†ã‚¹ãƒˆç”¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
                test_account = self._create_account_from_form()
                
                # å—ä¿¡ã‚µãƒ¼ãƒãƒ¼ãƒ†ã‚¹ãƒˆ
                incoming_result = self._test_incoming_server(test_account)
                
                # é€ä¿¡ã‚µãƒ¼ãƒãƒ¼ãƒ†ã‚¹ãƒˆ
                outgoing_result = self._test_outgoing_server(test_account)
                
                # çµæœã‚’ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã§å‡¦ç†
                self.dialog.after(0, lambda: self._handle_connection_test_result(
                    incoming_result, outgoing_result
                ))
                
            except Exception as e:
                self.dialog.after(0, lambda: self._handle_connection_test_error(str(e)))
        
        # ãƒ†ã‚¹ãƒˆã‚¹ãƒ¬ãƒƒãƒ‰ã‚’é–‹å§‹
        test_thread = threading.Thread(target=test_connection, daemon=True)
        test_thread.start()
        
    except Exception as e:
        logger.error(f"æ¥ç¶šãƒ†ã‚¹ãƒˆé–‹å§‹ã‚¨ãƒ©ãƒ¼: {e}")
        self._update_connection_status(f"âŒ æ¥ç¶šãƒ†ã‚¹ãƒˆã®é–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸ: {e}", "error")

def _test_incoming_server(self, account: Account) -> Dict[str, Any]:
    """å—ä¿¡ã‚µãƒ¼ãƒãƒ¼ã®æ¥ç¶šãƒ†ã‚¹ãƒˆ"""
    try:
        from src.mail.mail_client_factory import MailClientFactory
        
        # å—ä¿¡ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆ
        client = MailClientFactory.create_receive_client(account)
        
        if client:
            # æ¥ç¶šãƒ†ã‚¹ãƒˆ
            connected = client.connect()
            if connected:
                # ãƒ•ã‚©ãƒ«ãƒ€ãƒªã‚¹ãƒˆã‚’å–å¾—ã—ã¦ãƒ†ã‚¹ãƒˆ
                folders = client.list_folders()
                client.disconnect()
                
                return {
                    "success": True,
                    "message": f"å—ä¿¡ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šæˆåŠŸ ({len(folders)}å€‹ã®ãƒ•ã‚©ãƒ«ãƒ€ã‚’ç¢ºèª)",
                    "details": f"ã‚µãƒ¼ãƒãƒ¼: {account.settings.incoming_server}:{account.settings.incoming_port}"
                }
            else:
                return {
                    "success": False,
                    "message": "å—ä¿¡ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“ã§ã—ãŸ",
                    "details": "ã‚µãƒ¼ãƒãƒ¼è¨­å®šã¾ãŸã¯èªè¨¼æƒ…å ±ã‚’ç¢ºèªã—ã¦ãã ã•ã„"
                }
        else:
            return {
                "success": False,
                "message": "å—ä¿¡ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ",
                "details": "ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„"
            }
            
    except Exception as e:
        return {
            "success": False,
            "message": f"å—ä¿¡ã‚µãƒ¼ãƒãƒ¼ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: {str(e)}",
            "details": "è¨­å®šå†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„"
        }
```

### ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¿å­˜å‡¦ç†

```python
def _save_account(self):
    """ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä¿å­˜"""
    try:
        # å…¥åŠ›æ¤œè¨¼
        if not self._validate_form():
            return
        
        # ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
        account = self._create_account_from_form()
        
        # ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†å™¨ã‚’ä½¿ç”¨ã—ã¦ä¿å­˜
        if self.account:
            # æ—¢å­˜ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®æ›´æ–°
            success, message = self.account_manager.update_account(account)
        else:
            # æ–°è¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®è¿½åŠ 
            success, message = self.account_manager.add_account(account)
        
        if success:
            self.result_account = account
            
            # æˆåŠŸã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å®Ÿè¡Œ
            if self.success_callback:
                self.success_callback(account)
            
            messagebox.showinfo(
                "ä¿å­˜å®Œäº†",
                f"ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€Œ{account.name}ã€ã‚’æ­£å¸¸ã«ä¿å­˜ã—ã¾ã—ãŸã€‚",
                parent=self.dialog
            )
            
            logger.info(f"ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¿å­˜æˆåŠŸ: {account.name} ({account.email_address})")
            self.dialog.destroy()
            
        else:
            messagebox.showerror(
                "ä¿å­˜ã‚¨ãƒ©ãƒ¼",
                f"ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ:\n{message}",
                parent=self.dialog
            )
            
    except Exception as e:
        logger.error(f"ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¿å­˜ã‚¨ãƒ©ãƒ¼: {e}")
        messagebox.showerror(
            "ã‚¨ãƒ©ãƒ¼",
            f"äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:\n{e}",
            parent=self.dialog
        )
```

### è‡ªå‹•è¨­å®šæ©Ÿèƒ½

```python
def _set_gmail_server_settings(self):
    """Gmailç”¨ã‚µãƒ¼ãƒãƒ¼è¨­å®šã‚’è‡ªå‹•è¨­å®š"""
    self.incoming_server_var.set("imap.gmail.com")
    self.incoming_port_var.set(993)
    self.incoming_security_var.set("SSL")
    
    self.outgoing_server_var.set("smtp.gmail.com")
    self.outgoing_port_var.set(587)
    self.outgoing_security_var.set("STARTTLS")

def _set_yahoo_server_settings(self):
    """Yahooç”¨ã‚µãƒ¼ãƒãƒ¼è¨­å®šã‚’è‡ªå‹•è¨­å®š"""
    self.incoming_server_var.set("imap.mail.yahoo.com")
    self.incoming_port_var.set(993)
    self.incoming_security_var.set("SSL")
    
    self.outgoing_server_var.set("smtp.mail.yahoo.com")
    self.outgoing_port_var.set(587)
    self.outgoing_security_var.set("STARTTLS")

def _set_outlook_server_settings(self):
    """Outlookç”¨ã‚µãƒ¼ãƒãƒ¼è¨­å®šã‚’è‡ªå‹•è¨­å®š"""
    self.incoming_server_var.set("outlook.office365.com")
    self.incoming_port_var.set(993)
    self.incoming_security_var.set("SSL")
    
    self.outgoing_server_var.set("smtp-mail.outlook.com")
    self.outgoing_port_var.set(587)
    self.outgoing_security_var.set("STARTTLS")
```

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿè£…

### åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ
**ãƒ•ã‚¡ã‚¤ãƒ«**: `tests/test_account_dialog.py` (15ãƒ†ã‚¹ãƒˆ)

```python
class TestAccountDialog:
    """ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¹"""
    
    def test_dialog_initialization(self):
        """ãƒ€ã‚¤ã‚¢ãƒ­ã‚°åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ"""
        # æ–°è¦ãƒ»ç·¨é›†ãƒ¢ãƒ¼ãƒ‰åˆ¥ã®åˆæœŸåŒ–ç¢ºèª
        
    def test_oauth2_authentication_flow(self):
        """OAuth2èªè¨¼ãƒ•ãƒ­ãƒ¼ãƒ†ã‚¹ãƒˆ"""
        # èªè¨¼é–‹å§‹ã‹ã‚‰å®Œäº†ã¾ã§ã®æµã‚Œç¢ºèª
        
    def test_manual_settings_validation(self):
        """æ‰‹å‹•è¨­å®šæ¤œè¨¼ãƒ†ã‚¹ãƒˆ"""
        # å…¥åŠ›å€¤ã®æ¤œè¨¼ãƒ«ãƒ¼ãƒ«ç¢ºèª
        
    def test_connection_testing(self):
        """æ¥ç¶šãƒ†ã‚¹ãƒˆæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ"""
        # å—ä¿¡ãƒ»é€ä¿¡ã‚µãƒ¼ãƒãƒ¼ã®æ¥ç¶šç¢ºèª
        
    def test_account_saving(self):
        """ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¿å­˜ãƒ†ã‚¹ãƒˆ"""
        # æ–°è¦ãƒ»æ›´æ–°ã®ä¿å­˜å‡¦ç†ç¢ºèª
```

### ãƒ‡ãƒ¢ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/demo_account_dialog.py`

```python
def demo_new_account():
    """æ–°è¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆã®ãƒ‡ãƒ¢"""
    
def demo_edit_account():
    """æ—¢å­˜ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç·¨é›†ã®ãƒ‡ãƒ¢"""
    
def demo_gmail_oauth2():
    """Gmail OAuth2èªè¨¼ã®ãƒ‡ãƒ¢"""
    
def demo_manual_settings():
    """æ‰‹å‹•è¨­å®šã®ãƒ‡ãƒ¢"""
```

---

## ğŸ“ˆ å®Ÿè£…æˆæœ

### æ©Ÿèƒ½çš„æˆæœ
- âœ… **çµ±åˆèªè¨¼**: OAuth2ã¨æ‰‹å‹•è¨­å®šã®ä¸¡å¯¾å¿œ
- âœ… **è‡ªå‹•è¨­å®š**: ä¸»è¦ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®è¨­å®šè‡ªå‹•åŒ–
- âœ… **æ¥ç¶šãƒ†ã‚¹ãƒˆ**: è¨­å®šã®äº‹å‰æ¤œè¨¼
- âœ… **ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£**: ç›´æ„Ÿçš„ã§åˆ†ã‹ã‚Šã‚„ã™ã„UI

### æŠ€è¡“çš„æˆæœ
- âœ… **éåŒæœŸå‡¦ç†**: UIãƒ–ãƒ­ãƒƒã‚¯ã—ãªã„èªè¨¼ãƒ»ãƒ†ã‚¹ãƒˆå‡¦ç†
- âœ… **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: åŒ…æ‹¬çš„ãªã‚¨ãƒ©ãƒ¼å¯¾å¿œ
- âœ… **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: OAuth2ãƒˆãƒ¼ã‚¯ãƒ³ã®å®‰å…¨ãªç®¡ç†
- âœ… **æ‹¡å¼µæ€§**: æ–°ã—ã„ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã®è¿½åŠ å¯¾å¿œ

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“
- âœ… **ä¾˜ã³å¯‚ã³ä½“é¨“**: é™ã‹ã§ç¾ã—ã„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šç’°å¢ƒ
- âœ… **æ®µéšçš„ã‚¬ã‚¤ãƒ‰**: è¿·ã„ã®ãªã„è¨­å®šãƒ•ãƒ­ãƒ¼
- âœ… **å³åº§ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãªçŠ¶æ…‹è¡¨ç¤º
- âœ… **å®‰å¿ƒæ„Ÿ**: äº‹å‰ãƒ†ã‚¹ãƒˆã«ã‚ˆã‚‹ç¢ºå®Ÿãªè¨­å®š

---

## ğŸ”„ ä¸»è¦ãªè¨­å®šãƒ•ãƒ­ãƒ¼

### Gmail OAuth2èªè¨¼ãƒ•ãƒ­ãƒ¼
1. **OAuth2ã‚¿ãƒ–é¸æŠ** â†’ æ¨å¥¨èªè¨¼æ–¹å¼ã®èª¬æ˜è¡¨ç¤º
2. **èªè¨¼ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯** â†’ ãƒ–ãƒ©ã‚¦ã‚¶ã§Googleèªè¨¼
3. **èªè¨¼å®Œäº†** â†’ è‡ªå‹•çš„ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±å–å¾—
4. **è¨­å®šç¢ºèª** â†’ Gmailè¨­å®šã®è‡ªå‹•é©ç”¨
5. **ä¿å­˜** â†’ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²å®Œäº†

### æ‰‹å‹•è¨­å®šãƒ•ãƒ­ãƒ¼
1. **æ‰‹å‹•è¨­å®šã‚¿ãƒ–é¸æŠ** â†’ è©³ç´°è¨­å®šãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤º
2. **åŸºæœ¬æƒ…å ±å…¥åŠ›** â†’ åå‰ã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
3. **ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼é¸æŠ** â†’ Gmail/Yahoo/Outlook/ãã®ä»–
4. **ã‚µãƒ¼ãƒãƒ¼è¨­å®š** â†’ å—ä¿¡ãƒ»é€ä¿¡ã‚µãƒ¼ãƒãƒ¼è©³ç´°
5. **æ¥ç¶šãƒ†ã‚¹ãƒˆ** â†’ è¨­å®šã®äº‹å‰ç¢ºèª
6. **ä¿å­˜** â†’ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²å®Œäº†

---

## ğŸŒ¸ ä¾˜ã³å¯‚ã³ç¾å­¦ã®å®Ÿç¾

### è¦–è¦šçš„èª¿å’Œ
- **ç´”ç™½ã®èƒŒæ™¯**: å¿ƒã‚’è½ã¡ç€ã‹ã›ã‚‹æ¸…æ½”ãªç’°å¢ƒ
- **å¢¨è‰²ã®æ–‡å­—**: èª­ã¿ã‚„ã™ãç¾ã—ã„æ–‡å­—è‰²
- **ç¹Šç´°ãªå¢ƒç•Œç·š**: æ§ãˆã‚ã§ä¸Šå“ãªåŒºåˆ‡ã‚Š
- **è‡ªç„¶ãªè‰²èª¿**: ç›®ã«å„ªã—ã„å’Œã®è‰²å½©

### æ“ä½œã®é™å¯‚æ€§
- **æ§ãˆã‚ãªãƒœã‚¿ãƒ³**: æ©Ÿèƒ½çš„ã§ã‚ã‚ŠãªãŒã‚‰ç¾ã—ã„
- **è‡ªç„¶ãªé…ç½®**: ç›´æ„Ÿçš„ãªæ“ä½œãƒ•ãƒ­ãƒ¼
- **é™ã‹ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯**: é‚ªé­”ã«ãªã‚‰ãªã„çŠ¶æ…‹è¡¨ç¤º
- **ä½™ç™½ã®ç¾**: é©åˆ‡ãªç©ºé–“ã«ã‚ˆã‚‹è¦–è¦šçš„ä¼‘æ¯

### å¿ƒã‚’è¾¼ã‚ãŸä½“é¨“
- **è¨­å®šã®å®‰ã‚‰ã**: ã‚¹ãƒˆãƒ¬ã‚¹ãƒ•ãƒªãƒ¼ãªã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š
- **èªè¨¼ã®å®‰å¿ƒ**: OAuth2ã«ã‚ˆã‚‹å®‰å…¨ãªèªè¨¼
- **ãƒ†ã‚¹ãƒˆã®ç¢ºä¿¡**: äº‹å‰ç¢ºèªã«ã‚ˆã‚‹å®‰å¿ƒæ„Ÿ
- **ä¿å­˜ã®é”æˆæ„Ÿ**: å®Œäº†æ™‚ã®æº€è¶³æ„Ÿ

---

## ğŸ‰ Task 7 å®Œäº†

**ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šç”»é¢å®Ÿè£…**ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸã€‚

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—
- âœ… **Task 7**: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šç”»é¢ â†’ **å®Œäº†**
- âœ… **Task 8**: ãƒ¡ãƒ¼ãƒ«è¡¨ç¤ºæ©Ÿèƒ½å®Ÿè£…
- âœ… **Task 9**: ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ©Ÿèƒ½å®Ÿè£…

ä¾˜ã³å¯‚ã³ã®ç¾å­¦ã«åŸºã¥ã„ãŸã€å¿ƒã‚’è¾¼ã‚ãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šä½“é¨“ã‚’å®Ÿç¾ã§ãã¾ã—ãŸã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯é™ã‹ã§ç¾ã—ã„ç’°å¢ƒã§ã€å®‰å…¨ã‹ã¤ç°¡å˜ã«ãƒ¡ãƒ¼ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

---

**ğŸŒ¸ é™å¯‚ã®ä¸­ã®ç¾ã—ã•ã‚’è¿½æ±‚ã—ã¦**

**WabiMailé–‹ç™ºãƒãƒ¼ãƒ **  
*2025å¹´7æœˆ1æ—¥*